---
phase: 23-build-fixes-test-generator-core
plan: 04
type: execute
wave: 3
depends_on:
  - 23-02
  - 23-03
files_modified:
  - R/*.R
autonomous: true
requirements:
  - BUILD-01
  - BUILD-06

must_haves:
  truths:
    - "All experimental stubs are regenerated from the fixed generator with valid R syntax"
    - "R CMD check produces 0 errors"
    - "All generated roxygen @param tags match function signatures"
    - "devtools::document() runs without warnings about param mismatches"
  artifacts:
    - path: "R/*.R"
      provides: "Regenerated stubs with valid syntax and correct documentation"
  key_links:
    - from: "dev/generate_stubs.R"
      to: "R/*.R"
      via: "Stub generation pipeline writes regenerated files"
      pattern: "writeLines|write_stub"
---

<objective>
Purge experimental stubs and regenerate them from the fixed generator, then run R CMD check to verify the entire package builds cleanly.

Purpose: Per user decision, after fixing the generator (Plan 02) we purge and regenerate all experimental stubs. This is the final validation step — R CMD check must produce 0 errors, confirming all BUILD requirements are satisfied.

Output: Clean R CMD check with 0 errors. All regenerated stubs have valid syntax and matching roxygen docs.
</objective>

<execution_context>
@C:/Users/sxthi/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/sxthi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/23-build-fixes-test-generator-core/23-CONTEXT.md
@.planning/phases/23-build-fixes-test-generator-core/23-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Purge experimental stubs and regenerate from fixed generator</name>
  <files>R/*.R</files>
  <action>
1. Identify experimental stubs: Look for files in R/ with `@lifecycle experimental` or the lifecycle badge pattern. These are auto-generated stubs that should be regenerated. Check if there's an existing script for purging (the CONTEXT.md mentions "existing scripts").

2. Delete the experimental stub files. Do NOT delete manually maintained functions (ct_hazard.R, ct_cancer.R, ct_env_fate.R, chemi_toxprint.R, chemi_safety.R, etc. — the 14 functions listed in CLAUDE.md as already using generic_request/generic_chemi_request).

3. Run the fixed stub generator:
   ```bash
   "C:\Program Files\R\R-4.5.1\bin\Rscript.exe" dev/generate_stubs.R
   ```
   This should regenerate all stubs with valid syntax and correct @param tags.

4. Run `devtools::document()` to regenerate NAMESPACE and .Rd files:
   ```bash
   "C:\Program Files\R\R-4.5.1\bin\Rscript.exe" -e "devtools::document()"
   ```

5. Verify all R/ files parse cleanly:
   ```bash
   "C:\Program Files\R\R-4.5.1\bin\Rscript.exe" -e "for(f in list.files('R', full.names=TRUE, pattern='\\.R$')) { tryCatch(parse(file=f), error=function(e) stop(paste(f, e$message))) }; cat('All files parse OK\n')"
   ```
  </action>
  <verify>
    <automated>"C:\Program Files\R\R-4.5.1\bin\Rscript.exe" -e "files <- list.files('R', full.names=TRUE, pattern='\\.R$'); for(f in files){tryCatch(parse(file=f), error=function(e) stop(paste(f, ':', e$message)))}; cat(length(files), 'files parse OK\n')"</automated>
  </verify>
  <done>All experimental stubs regenerated with valid syntax, all R/ files parse without errors</done>
</task>

<task type="auto">
  <name>Task 2: Run R CMD check and fix any remaining issues</name>
  <files>R/*.R, DESCRIPTION, NAMESPACE</files>
  <action>
1. Run R CMD check:
   ```bash
   "C:\Program Files\R\R-4.5.1\bin\Rscript.exe" -e "devtools::check(args = c('--no-examples', '--no-tests', '--no-vignettes'))"
   ```
   Use --no-examples/--no-tests/--no-vignettes for the initial pass to focus on build issues (syntax, imports, documentation).

2. Review the check output for:
   - ERRORS: Must be zero. Fix any remaining issues.
   - WARNINGS: Fix "Documented arguments not in \usage", "Non-standard license", "Undocumented arguments", partial match warnings.
   - NOTES: Address non-ASCII, import collisions, missing imports.

3. If any issues remain, fix them iteratively:
   - For remaining roxygen mismatches: fix the @param tags in the affected file
   - For remaining import issues: update DESCRIPTION or add explicit namespace prefixes
   - For any new syntax errors: fix in 07_stub_generation.R and regenerate the affected stub

4. Re-run R CMD check until 0 errors and 0 warnings (notes are acceptable if minor).

5. Run the existing test suite to check for regressions:
   ```bash
   "C:\Program Files\R\R-4.5.1\bin\Rscript.exe" -e "devtools::test()"
   ```
   Note: Many tests will still fail (bad cassettes from Phase 24 work), but there should be no new R-level errors (syntax, missing functions, etc.).
  </action>
  <verify>
    <automated>"C:\Program Files\R\R-4.5.1\bin\Rscript.exe" -e "res <- devtools::check(args = c('--no-examples', '--no-tests', '--no-vignettes'), quiet = TRUE); if(length(res$errors) > 0) stop(paste('ERRORS:', paste(res$errors, collapse='\n'))); cat('R CMD check: 0 errors\n')"</automated>
  </verify>
  <done>R CMD check produces 0 errors, 0 warnings related to BUILD-01 through BUILD-08 issues</done>
</task>

</tasks>

<verification>
After both tasks:
1. R CMD check with --no-examples --no-tests --no-vignettes produces 0 errors
2. All R/ files parse without syntax errors
3. devtools::document() produces no undocumented/mismatched @param warnings
4. No partial argument match warnings
5. Valid license in DESCRIPTION
</verification>

<success_criteria>
- R CMD check: 0 errors (the primary success criterion for the entire phase)
- All regenerated stubs have syntactically valid R code
- All roxygen @param tags match their function signatures
- Package loads cleanly with devtools::load_all()
</success_criteria>

<output>
After completion, create `.planning/phases/23-build-fixes-test-generator-core/23-04-SUMMARY.md`
</output>
